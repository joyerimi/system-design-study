# 5장 : 안정 해시 설계

### 해시 ?
임의의 길이의 데이터를 고정된 길이의 데이터로 매핑하는 함수를 해시 함수라고 합니다.
해시 함수에 의해 얻어지는 값을 해시 값, 해시 코드, 해시 체크섬 혹은 간단하게 해시라고도 합니다.

해시 함수의 특징은 크게 3가지가 있습니다.
1. 단방향성 (One-way Property):
      해시 함수는 입력값을 해시하여 출력값을 생성하지만, 출력값으로부터 원래 입력값을 역추론하는 것이 매우 어렵거나 불가능해야 합니다.
2. 충돌 저항성 (Collision Resistance):
   서로 다른 두 입력값이 동일한 해시값을 갖는 경우를 충돌이라고 합니다.
   좋은 해시 함수는 충돌이 발생할 가능성을 최소화하도록 설계되어야 합니다.
    오래된 해시 함수의 경우 충돌 가능성이 존재하므로 충돌가능성이 희박한 해시 함수를 사용해야 합니다. 
3. 동일 입력, 동일 출력 (Deterministic):
   동일한 입력값에 대해서는 항상 동일한 해시값을 반환해야 합니다. 

해시의 경우 수평적으로 규모를 확장한 서버에 고른 분포를 할 수 있게 도와줍니다.

## 해시 키 재배치 문제
N개의 캐시 서버가 있을 때 해시 함수를 사용하면 부하를 균등하게 나눌 수 있습니다.
만약 일부 서버에 장애가 발생해 중단되는 경우, 작동 가능한 서버 풀 내에서 해시 값을 재배치해주어야 합니다.
하지만 해시 함수의 값에 가용한 서버 수 N을 사용하는 경우(책의 경우 모듈러 연산에 사용) N이 변하며 캐시 미스가 발생할 수 있습니다.

![Image](https://github.com/user-attachments/assets/e423777a-3eca-4e14-809b-be49891c77f7)

기존에는 4대의 캐시 서버를 사용해서 값을 저장하였지만, server1이 중단되면 % 3 연산을 하게 되고, 이는 상당 수의 캐시 미스가 발생하게 됩니다.
이러한 문제를 해결하기 위해 안정 해시를 사용합니다.

## 안정 해시
해시 테이블 크기가 조정될 때 평균적으로 k/n개의 키만 재배치하는 해시 기술입니다.
k는 키의 개수, n은 슬롯의 개수입니다.


### 참고문헌
[해시 함수](https://ko.wikipedia.org/wiki/%ED%95%B4%EC%8B%9C_%ED%95%A8%EC%88%98)

[해시 충돌 해결법](https://www.youtube.com/watch?v=Rpbj6jMYKag)

[Jump consistent hash](https://chongkong.github.io/jump-consistent-hash)